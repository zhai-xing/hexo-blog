{
    "version": "https://jsonfeed.org/version/1",
    "title": "Mo Bai • All posts by \"事故排查\" tag",
    "description": "欢迎来到墨白的知识小屋，这里你可以阅读我的学习笔记并提出独到的见解~我们将互相学习交流知识，共同进步",
    "home_page_url": "https://zhai-xing.github.io/hexo-blog",
    "items": [
        {
            "id": "https://zhai-xing.github.io/hexo-blog/permalink",
            "url": "https://zhai-xing.github.io/hexo-blog/permalink",
            "title": "异常排查",
            "date_published": "2027-01-04T16:00:00.000Z",
            "content_html": "<h2 id=\"day1\"><a href=\"#day1\" class=\"headerlink\" title=\"day1\"></a>day1</h2><h3 id=\"工具：\"><a href=\"#工具：\" class=\"headerlink\" title=\"工具：\"></a>工具：</h3><ol>\n<li>java: jstack,jmap,arthas</li>\n<li>jvm: gdb,strace,arthas</li>\n<li>操作系统: perf,bcc,bpftrace</li>\n<li>硬件资源：top,free iostat,iftop</li>\n<li>网络: ngrep  tcpdump</li>\n<li>mysql: perf,gdb,bcc,bptrace,strace</li>\n</ol>\n<h3 id=\"排查思路：\"><a href=\"#排查思路：\" class=\"headerlink\" title=\"排查思路：\"></a>排查思路：</h3><p>资源占用分析视角：</p>\n<p>自低向上：</p>\n<p>硬件资源使用率如何？如果发现某个资源占用率高,逐步向上分析</p>\n<ol>\n<li>什么进程占用cpu多</li>\n<li>什么线程占用cpu多</li>\n<li>什么代码占用cpu多</li>\n</ol>\n<p>系统负载分析视角：</p>\n<p>接口的QPS多少，耗时怎么样，有多少报错，</p>\n<ol>\n<li>controller层耗时高吗</li>\n<li>mappe层处理耗时高吗</li>\n<li>sql执行耗时高吗</li>\n<li>逐步向下分析时间占用</li>\n</ol>\n<p>排查思路：</p>\n<p>看日志-&gt;资源占用-&gt;排查工具 </p>\n<p>tps：其实80%的问题都会直接在日志中呈现出来，所以有一套日志分析平台很重要</p>\n<h2 id=\"day2\"><a href=\"#day2\" class=\"headerlink\" title=\"day2\"></a>day2</h2><p>如何看日志：</p>\n<p>命令：cat head,tail</p>\n<p>cat：输出文件内容  cat &#x2F;etc&#x2F;t1.txt</p>\n<p>head：查看文件前几行  示例：head -n2  &#x2F;etc&#x2F;t1.txt</p>\n<p>tail 查看文件后几行，-f不断查看新内容 tail -n2  &#x2F;etc&#x2F;t1.txt</p>\n<p>命令：vim</p>\n<p>vim是文本编辑工具。基操</p>\n<p>命令: less&#x2F;more</p>\n<p>分页文件查看器，因此可以查看大日志文件，因为是按需加载文件到内存。推荐使用less，相比more功能更多，</p>\n<p>grep命令：指定搜索关键字，可以从日志中搜索出包含关键字的日志，-i是忽略大小写 示例： grep -i error app.log</p>\n<p>awk命令：</p>\n<p>awk其实是为文本处理的脚本语言，后面简单学一下</p>\n<p>wc 用于对文本文件进行统计</p>\n<p>sort 用于对文本行进行排序与</p>\n<p>uniq 用于对文本去重</p>\n<h2 id=\"硬件资源观测\"><a href=\"#硬件资源观测\" class=\"headerlink\" title=\"硬件资源观测\"></a>硬件资源观测</h2><p>top命令</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2025/png/39206930/1744816894743-43a8a503-1253-4648-b457-b6bda35425aa.png\"></p>\n<p>红色指标:  系统的负载，分别是1分钟 5分钟15分钟</p>\n<p>黄色：系统任务状态，总任务，运行中，睡眠中，暂停，僵尸任务</p>\n<p>绿色：cpu使用率</p>\n<p>us：非niced进程(用户态)花费的cpu时间占比</p>\n<p>sy：内核进程花费的cpu时间占比</p>\n<p>ni niced进程花费的cpu时间占比</p>\n<p>id：内核空闲进程花费的cpu时间占比</p>\n<p>wa：等待磁盘io完成花费的cpu时间占比</p>\n<p>hi ：处理硬件中断</p>\n<p>si ：处理软件中断</p>\n<p>st：被其他虚拟机偷取的cpu时间占比</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2025/png/39206930/1744817426818-d5ea7060-68ec-4f7e-8fe9-cbfd027cc879.png\"></p>\n<p>mem</p>\n<p>total 总内存大小</p>\n<p>free：空闲内容大小</p>\n<p>used：使用中的内存大小</p>\n<p>buff&#x2F;cache:用于文件缓存与系统缓存的内存大小</p>\n<p>swap:</p>\n<p>total 总swap文件大小</p>\n<p>free：swap空闲内容大小</p>\n<p>used：swap使用中的内存大小</p>\n<p>avail Mem:可用内存大小，和swap无关</p>\n<p>top是一个交互式的命令</p>\n<p>也就是使用了top 可以按对应的键看不同信息</p>\n<p>1 查看1号cpu的各核使用情况</p>\n<p>M 进程按内存使用倒序</p>\n<p>P 进程按cpu使用倒序</p>\n<p>H 查看线程情况</p>\n<p>c 查看进程的完整命令行</p>\n<p>&lt;,&gt;,R 调整排序列</p>\n<p>o,&#x3D; o添加过滤条件，例如 command&#x3D;java </p>\n<p>q 退出top</p>\n<p>vmstat 命令</p>\n<p>1s显示一次，第一行是系统启动以来的统计信息，一般可以忽略不看</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2025/png/39206930/1744818599063-7561a10a-64b7-4630-8105-dbf23d0f0ac8.png\"></p>\n<p>r:cpu运行队列长度，也就是有多少线程等待操作系统调度运行。</p>\n<p>b:不可中断阻塞的线程数量，一般就算阻塞于io访问的线程数量</p>\n<p>swpd：内存交换到磁盘的内存大小</p>\n<p>free：剩余内存大小 单位kb</p>\n<p>buff：用于buff的内存大小，单位kb</p>\n<p>cache：用于文件页面缓存的内存大小 单位kb</p>\n<p>si: 磁盘换入到内存的当前速度，单位kb&#x2F;s</p>\n<p>so内存换出到磁盘的当前速度，单位kb&#x2F;s</p>\n<p>bi 每秒读取磁盘块数量，blocks&#x2F;s</p>\n<p>bo 每秒写入的磁盘块数量 block&#x2F;s</p>\n<p>in 每秒中断数量</p>\n<p>cs每秒切换上下文次数</p>\n<p>us cpu用户态使用率</p>\n<p>sy cpu内核态使用率</p>\n<p>id cpu空闲率</p>\n<p>wa 等待io 线程被阻塞 等待磁盘io时的cpu空闲时间占比</p>\n<p>st  steal偷取，cpu在虚拟化环境下在其他租户上的开销</p>\n<p>free命令 查看内存使用 -m是mb为单位</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2025/png/39206930/1744819579276-4c3c4406-fe92-4a5f-80c5-5d2c8a2ec4bf.png\"></p>\n<p>和top中内存部分类似，有一个经验知识：</p>\n<ol>\n<li>free: Linux中随着使用时间越长，free会越来越小，因为linux会把访问的文件数据经可能缓存在内存中，</li>\n<li>availble 系统真正的可用内存，约等于free+buff&#x2F;cache</li>\n</ol>\n<p>slabtop命令 </p>\n<p>slab是linux基于对象的一种内存分配机制，类似于对象池的概念，当linux需要一个内核对象时，如果slab中有，就可以直接获取对象，而不用申请内存块</p>\n<p>磁盘资源：</p>\n<p>df命令:<img data-src=\"https://cdn.nlark.com/yuque/0/2025/png/39206930/1744820505844-3e42468d-c635-4e85-9f69-b4b14b6706ac.png\"></p>\n<p>iostat:命令</p>\n<h3 id=\"sar命令\"><a href=\"#sar命令\" class=\"headerlink\" title=\"sar命令\"></a>sar命令</h3><p>sar是应该全方位的命令，这个命令背熟了可以替代前面的命令 ，使用  yum install sysstat 安装</p>\n<h4 id=\"cpu观测\"><a href=\"#cpu观测\" class=\"headerlink\" title=\"cpu观测\"></a>cpu观测</h4><p>命令 sar -u  例如 sar -u 1 3 每间隔1秒统计1次 共统计3次</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@localhost</span> ~]# sar -q <span class=\"number\">1</span> <span class=\"number\">3</span></span><br><span class=\"line\">Linux <span class=\"number\">3.10</span><span class=\"number\">.0</span>-<span class=\"number\">1160.</span>el7.x86_64 (localhost.localdomain)    <span class=\"number\">2025</span>年<span class=\"number\">04</span>月<span class=\"number\">26</span>日  _x86_64_        (<span class=\"number\">2</span> CPU)</span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">46</span>分<span class=\"number\">49</span>秒   runq-sz  plist-sz   ldavg-<span class=\"number\">1</span>   ldavg-<span class=\"number\">5</span>  ldavg-<span class=\"number\">15</span>   blocked</span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">46</span>分<span class=\"number\">50</span>秒         <span class=\"number\">0</span>       <span class=\"number\">187</span>      <span class=\"number\">0.01</span>      <span class=\"number\">0.04</span>      <span class=\"number\">0.05</span>         <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">46</span>分<span class=\"number\">51</span>秒         <span class=\"number\">0</span>       <span class=\"number\">187</span>      <span class=\"number\">0.01</span>      <span class=\"number\">0.04</span>      <span class=\"number\">0.05</span>         <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">46</span>分<span class=\"number\">52</span>秒         <span class=\"number\">0</span>       <span class=\"number\">187</span>      <span class=\"number\">0.01</span>      <span class=\"number\">0.04</span>      <span class=\"number\">0.05</span>         <span class=\"number\">0</span></span><br><span class=\"line\">平均时间:         <span class=\"number\">0</span>       <span class=\"number\">187</span>      <span class=\"number\">0.01</span>      <span class=\"number\">0.04</span>      <span class=\"number\">0.05</span>         <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<p><font style=\"color:rgb(0, 0, 0);\">%user #用户空间的CPU使用</font><br><font style=\"color:rgb(0, 0, 0);\">%nice 改变过优先级的进程的CPU使用率</font><br><font style=\"color:rgb(0, 0, 0);\">%system 内核空间的CPU使用率</font><br><font style=\"color:rgb(0, 0, 0);\">%iowait CPU等待IO的百分比</font><br><font style=\"color:rgb(0, 0, 0);\">%steal 虚拟机的虚拟机CPU使用的CPU</font><br><font style=\"color:rgb(0, 0, 0);\">%idle 空闲的CPU</font><br><font style=\"color:rgb(0, 0, 0);\">在以上的显示当中，主要看%iowait和%idle，%iowait过高表示存在I&#x2F;O瓶颈，即磁盘IO无法满足业务需求，如果%idle过低表示CPU使用率比较严重，需要结合内存使用等情况判断CPU是否瓶颈。</font></p>\n<h4 id=\"平均负载统计分析\"><a href=\"#平均负载统计分析\" class=\"headerlink\" title=\"平均负载统计分析\"></a><font style=\"color:rgb(0, 0, 0);\">平均负载统计分析</font></h4><p>命令 sar -q 例如 sar -q 1 3  每间隔1秒统计1次 共统计3次</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@localhost</span> ~]# sar -q <span class=\"number\">1</span> <span class=\"number\">3</span></span><br><span class=\"line\">Linux <span class=\"number\">3.10</span><span class=\"number\">.0</span>-<span class=\"number\">1160.</span>el7.x86_64 (localhost.localdomain)    <span class=\"number\">2025</span>年<span class=\"number\">04</span>月<span class=\"number\">26</span>日  _x86_64_        (<span class=\"number\">2</span> CPU)</span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">46</span>分<span class=\"number\">49</span>秒   runq-sz  plist-sz   ldavg-<span class=\"number\">1</span>   ldavg-<span class=\"number\">5</span>  ldavg-<span class=\"number\">15</span>   blocked</span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">46</span>分<span class=\"number\">50</span>秒         <span class=\"number\">0</span>       <span class=\"number\">187</span>      <span class=\"number\">0.01</span>      <span class=\"number\">0.04</span>      <span class=\"number\">0.05</span>         <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">46</span>分<span class=\"number\">51</span>秒         <span class=\"number\">0</span>       <span class=\"number\">187</span>      <span class=\"number\">0.01</span>      <span class=\"number\">0.04</span>      <span class=\"number\">0.05</span>         <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">46</span>分<span class=\"number\">52</span>秒         <span class=\"number\">0</span>       <span class=\"number\">187</span>      <span class=\"number\">0.01</span>      <span class=\"number\">0.04</span>      <span class=\"number\">0.05</span>         <span class=\"number\">0</span></span><br><span class=\"line\">平均时间:         <span class=\"number\">0</span>       <span class=\"number\">187</span>      <span class=\"number\">0.01</span>      <span class=\"number\">0.04</span>      <span class=\"number\">0.05</span>         <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<p><font style=\"color:rgb(0, 0, 0);\">runq-sz 运行队列的长度（等待运行的进程数，每核的CP不能超过3个）</font><br><font style=\"color:rgb(0, 0, 0);\">plist-sz 进程列表中的进程（processes）和线程数（threads）的数量</font><br><font style=\"color:rgb(0, 0, 0);\">ldavg-1 最后1分钟的CPU平均负载，即将多核CPU过去一分钟的负载相加再除以核心数得出的平均值，5分钟和15分钟以此类推</font><br><font style=\"color:rgb(0, 0, 0);\">ldavg-5 最后5分钟的CPU平均负载</font><br><font style=\"color:rgb(0, 0, 0);\">ldavg-15 最后15分钟的CPU平均负载</font></p>\n<h4 id=\"内存统计分析\"><a href=\"#内存统计分析\" class=\"headerlink\" title=\"内存统计分析\"></a><font style=\"color:rgb(0, 0, 0);\">内存统计分析</font></h4><p>sar -r 1 3     每间隔1秒统计1次 共统计3次</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@localhost</span> ~]# sar -r <span class=\"number\">1</span> <span class=\"number\">3</span></span><br><span class=\"line\">Linux <span class=\"number\">3.10</span><span class=\"number\">.0</span>-<span class=\"number\">1160.</span>el7.x86_64 (localhost.localdomain)    <span class=\"number\">2025</span>年<span class=\"number\">04</span>月<span class=\"number\">26</span>日  _x86_64_        (<span class=\"number\">2</span> CPU)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">50</span>分<span class=\"number\">04</span>秒 kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty</span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">50</span>分<span class=\"number\">05</span>秒   <span class=\"number\">3262412</span>    <span class=\"number\">618100</span>     <span class=\"number\">15.93</span>      <span class=\"number\">2108</span>    <span class=\"number\">291468</span>    <span class=\"number\">306820</span>      <span class=\"number\">3.86</span>    <span class=\"number\">244056</span>    <span class=\"number\">125584</span>        <span class=\"number\">24</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">50</span>分<span class=\"number\">06</span>秒   <span class=\"number\">3262116</span>    <span class=\"number\">618396</span>     <span class=\"number\">15.94</span>      <span class=\"number\">2108</span>    <span class=\"number\">291472</span>    <span class=\"number\">307088</span>      <span class=\"number\">3.87</span>    <span class=\"number\">244136</span>    <span class=\"number\">125584</span>        <span class=\"number\">28</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">50</span>分<span class=\"number\">07</span>秒   <span class=\"number\">3262288</span>    <span class=\"number\">618224</span>     <span class=\"number\">15.93</span>      <span class=\"number\">2108</span>    <span class=\"number\">291476</span>    <span class=\"number\">306820</span>      <span class=\"number\">3.86</span>    <span class=\"number\">243952</span>    <span class=\"number\">125584</span>        <span class=\"number\">20</span></span><br><span class=\"line\">平均时间:   <span class=\"number\">3262272</span>    <span class=\"number\">618240</span>     <span class=\"number\">15.93</span>      <span class=\"number\">2108</span>    <span class=\"number\">291472</span>    <span class=\"number\">306909</span>      <span class=\"number\">3.86</span>    <span class=\"number\">244048</span>    <span class=\"number\">125584</span>        <span class=\"number\">24</span></span><br><span class=\"line\">[root<span class=\"meta\">@localhost</span> ~]# </span><br></pre></td></tr></table></figure>\n\n<p><font style=\"color:rgb(0, 0, 0);\">kbmemfree 空闲的物理内存大小<br></font><font style=\"color:rgb(0, 0, 0);\">kbmemused 使用中的物理内存大小<br></font><font style=\"color:rgb(0, 0, 0);\">%memused 物理内存使用率<br></font><font style=\"color:rgb(0, 0, 0);\">kbbuffers 内核中作为缓冲区使用的物理内存大小，kbbuffers和kbcached:这两个值就是free命令中的buffer和cache.<br></font><font style=\"color:rgb(0, 0, 0);\">kbcached 缓存的文件大小<br></font><font style=\"color:rgb(0, 0, 0);\">kbcommit 保证当前系统正常运行所需要的最小内存，即为了确保内存不溢出而需要的最少内存（物理内存+Swap分区）<br></font><font style=\"color:rgb(0, 0, 0);\">commit 这个值是kbcommit与内存总量（物理内存+swap分区）的一个百分比的值</font></p>\n<h4 id=\"统计swap分区\"><a href=\"#统计swap分区\" class=\"headerlink\" title=\"统计swap分区\"></a><font style=\"color:rgb(0, 0, 0);\">统计swap分区</font></h4><p><font style=\"color:rgb(0, 0, 0);\">查看系统swap分区的统计信息：每间隔1秒钟统计一次总共统计三次：#sar -W 1 3</font></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@localhost</span> ~]# sar -W <span class=\"number\">1</span> <span class=\"number\">3</span></span><br><span class=\"line\">Linux <span class=\"number\">3.10</span><span class=\"number\">.0</span>-<span class=\"number\">1160.</span>el7.x86_64 (localhost.localdomain)    <span class=\"number\">2025</span>年<span class=\"number\">04</span>月<span class=\"number\">26</span>日  _x86_64_        (<span class=\"number\">2</span> CPU)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">53</span>分<span class=\"number\">42</span>秒  pswpin/s pswpout/s</span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">53</span>分<span class=\"number\">43</span>秒      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">53</span>分<span class=\"number\">44</span>秒      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">53</span>分<span class=\"number\">45</span>秒      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\">平均时间:      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><font style=\"color:rgb(0, 0, 0);\">pswpin&#x2F;s 每秒从交换分区到系统的交换页面（swap page）数量</font><br><font style=\"color:rgb(0, 0, 0);\">pswpott&#x2F;s 每秒从系统交换到swap的交换页面（swap page）的数量</font></p>\n<h4 id=\"查看磁盘IO\"><a href=\"#查看磁盘IO\" class=\"headerlink\" title=\"查看磁盘IO\"></a><font style=\"color:rgb(0, 0, 0);\">查看磁盘IO</font></h4><p><font style=\"color:rgb(0, 0, 0);\">sar -b #查看I&#x2F;O和传递速率的统计信息，</font></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@localhost</span> ~]# sar -b <span class=\"number\">1</span> <span class=\"number\">3</span></span><br><span class=\"line\">Linux <span class=\"number\">3.10</span><span class=\"number\">.0</span>-<span class=\"number\">1160.</span>el7.x86_64 (localhost.localdomain)    <span class=\"number\">2025</span>年<span class=\"number\">04</span>月<span class=\"number\">26</span>日  _x86_64_        (<span class=\"number\">2</span> CPU)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">55</span>分<span class=\"number\">17</span>秒       tps      rtps      wtps   bread/s   bwrtn/s</span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">55</span>分<span class=\"number\">18</span>秒      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">55</span>分<span class=\"number\">19</span>秒      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">55</span>分<span class=\"number\">20</span>秒      <span class=\"number\">2.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">2.00</span>      <span class=\"number\">0.00</span>     <span class=\"number\">42.00</span></span><br><span class=\"line\">平均时间:      <span class=\"number\">0.67</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.67</span>      <span class=\"number\">0.00</span>     <span class=\"number\">14.00</span></span><br><span class=\"line\">[root<span class=\"meta\">@localhost</span> ~]# </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><font style=\"color:rgb(0, 0, 0);\">tps 磁盘每秒钟的IO总数，等于iostat中的tps</font><br><font style=\"color:rgb(0, 0, 0);\">rtps 每秒钟从磁盘读取的IO总数</font><br><font style=\"color:rgb(0, 0, 0);\">wtps 每秒钟从写入到磁盘的IO总数</font><br><font style=\"color:rgb(0, 0, 0);\">bread&#x2F;s 每秒钟从磁盘读取的块总数</font><br><font style=\"color:rgb(0, 0, 0);\">bwrtn&#x2F;s 每秒钟此写入到磁盘的块总数</font></p>\n<h4 id=\"磁盘使用详情统计\"><a href=\"#磁盘使用详情统计\" class=\"headerlink\" title=\"磁盘使用详情统计\"></a><font style=\"color:rgb(0, 0, 0);\">磁盘使用详情统计</font></h4><p><font style=\"color:rgb(0, 0, 0);\">sar -d #磁盘使用详情统计</font></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@localhost</span> ~]# sar -d</span><br><span class=\"line\">Linux <span class=\"number\">3.10</span><span class=\"number\">.0</span>-<span class=\"number\">1160.</span>el7.x86_64 (localhost.localdomain)    <span class=\"number\">2025</span>年<span class=\"number\">04</span>月<span class=\"number\">26</span>日  _x86_64_        (<span class=\"number\">2</span> CPU)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">40</span>分<span class=\"number\">02</span>秒       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util</span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">50</span>分<span class=\"number\">01</span>秒    dev8-<span class=\"number\">0</span>      <span class=\"number\">0.80</span>      <span class=\"number\">0.00</span>     <span class=\"number\">21.61</span>     <span class=\"number\">27.14</span>      <span class=\"number\">0.00</span>      <span class=\"number\">3.87</span>      <span class=\"number\">1.82</span>      <span class=\"number\">0.14</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">50</span>分<span class=\"number\">01</span>秒  dev253-<span class=\"number\">0</span>      <span class=\"number\">0.83</span>      <span class=\"number\">0.00</span>     <span class=\"number\">21.55</span>     <span class=\"number\">25.97</span>      <span class=\"number\">0.00</span>      <span class=\"number\">3.83</span>      <span class=\"number\">1.75</span>      <span class=\"number\">0.15</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">50</span>分<span class=\"number\">01</span>秒  dev253-<span class=\"number\">1</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\">平均时间:    dev8-<span class=\"number\">0</span>      <span class=\"number\">0.80</span>      <span class=\"number\">0.00</span>     <span class=\"number\">21.61</span>     <span class=\"number\">27.14</span>      <span class=\"number\">0.00</span>      <span class=\"number\">3.87</span>      <span class=\"number\">1.82</span>      <span class=\"number\">0.14</span></span><br><span class=\"line\">平均时间:  dev253-<span class=\"number\">0</span>      <span class=\"number\">0.83</span>      <span class=\"number\">0.00</span>     <span class=\"number\">21.55</span>     <span class=\"number\">25.97</span>      <span class=\"number\">0.00</span>      <span class=\"number\">3.83</span>      <span class=\"number\">1.75</span>      <span class=\"number\">0.15</span></span><br><span class=\"line\">平均时间:  dev253-<span class=\"number\">1</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\">[root<span class=\"meta\">@localhost</span> ~]# </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><font style=\"color:rgb(0, 0, 0);\">DEV 磁盘设备的名称，如果不加-p，会显示dev253-0类似的设备名称，因此加上-p显示的名称更直接</font><br><font style=\"color:rgb(0, 0, 0);\">tps：每秒I&#x2F;O的传输总数</font><br><font style=\"color:rgb(0, 0, 0);\">rd_sec&#x2F;s 每秒读取的扇区的总数</font><br><font style=\"color:rgb(0, 0, 0);\">wr_sec&#x2F;s 每秒写入的扇区的总数</font><br><font style=\"color:rgb(0, 0, 0);\">avgrq-sz 平均每次次磁盘I&#x2F;O操作的数据大小（扇区）</font><br><font style=\"color:rgb(0, 0, 0);\">avgqu-sz 磁盘请求队列的平均长度</font><br><font style=\"color:rgb(0, 0, 0);\">await 从请求磁盘操作到系统完成处理，每次请求的平均消耗时间，包括请求队列等待时间，单位是毫秒（1秒等于1000毫秒），等于寻道时间+队列时间+服务时间</font><br><font style=\"color:rgb(0, 0, 0);\">svctm I&#x2F;O的服务处理时间，即不包括请求队列中的时间</font><br><font style=\"color:rgb(0, 0, 0);\">%util I&#x2F;O请求占用的CPU百分比，值越高，说明I&#x2F;O越慢</font></p>\n<h4 id=\"网络使用分析\"><a href=\"#网络使用分析\" class=\"headerlink\" title=\"网络使用分析\"></a>网络使用分析</h4><p><font style=\"color:rgb(0, 0, 0);\">sar -n #统计网络信息</font><br><font style=\"color:rgb(0, 0, 0);\">sar -n选项使用6个不同的开关：DEV，EDEV，NFS，NFSD，SOCK，IP，EIP，ICMP，EICMP，TCP，ETCP，UDP，SOCK6，IP6，EIP6，ICMP6，EICMP6和UDP6 ，DEV显示网络接口信息，EDEV显示关于网络错误的统计数据，NFS统计活动的NFS客户端的信息，NFSD统计NFS服务器的信息，SOCK显示套接字信息，ALL显示所有5个开关。它们可以单独或者一起使用。</font></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@localhost</span> ~]# sar -n DEV <span class=\"number\">1</span> <span class=\"number\">3</span></span><br><span class=\"line\">Linux <span class=\"number\">3.10</span><span class=\"number\">.0</span>-<span class=\"number\">1160.</span>el7.x86_64 (localhost.localdomain)    <span class=\"number\">2025</span>年<span class=\"number\">04</span>月<span class=\"number\">26</span>日  _x86_64_        (<span class=\"number\">2</span> CPU)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">58</span>分<span class=\"number\">50</span>秒     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">58</span>分<span class=\"number\">51</span>秒    ens192     <span class=\"number\">21.00</span>     <span class=\"number\">24.00</span>      <span class=\"number\">3.23</span>      <span class=\"number\">5.07</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">58</span>分<span class=\"number\">51</span>秒        lo      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">58</span>分<span class=\"number\">51</span>秒     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">58</span>分<span class=\"number\">52</span>秒    ens192     <span class=\"number\">29.00</span>     <span class=\"number\">35.00</span>      <span class=\"number\">3.25</span>      <span class=\"number\">9.99</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">58</span>分<span class=\"number\">52</span>秒        lo      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\">^C</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">58</span>分<span class=\"number\">52</span>秒     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">58</span>分<span class=\"number\">53</span>秒    ens192     <span class=\"number\">15.22</span>     <span class=\"number\">21.74</span>      <span class=\"number\">1.53</span>      <span class=\"number\">2.74</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">58</span>分<span class=\"number\">53</span>秒        lo      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\"></span><br><span class=\"line\">平均时间:     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</span><br><span class=\"line\">平均时间:    ens192     <span class=\"number\">21.92</span>     <span class=\"number\">27.05</span>      <span class=\"number\">2.70</span>      <span class=\"number\">6.02</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\">平均时间:        lo      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span>      <span class=\"number\">0.00</span></span><br><span class=\"line\">[root<span class=\"meta\">@localhost</span> ~]# </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><font style=\"color:rgb(0, 0, 0);\">IFACE 网卡名称<br></font><font style=\"color:rgb(0, 0, 0);\">rxerr&#x2F;s 每秒钟接收到的损坏的数据包<br></font><font style=\"color:rgb(0, 0, 0);\">txerr&#x2F;s 每秒钟发送的数据包错误数<br></font><font style=\"color:rgb(0, 0, 0);\">coll&#x2F;s 当发送数据包时候，每秒钟发生的冲撞（collisions）数，这个是在半双工模式下才有<br></font><font style=\"color:rgb(0, 0, 0);\">rxdrop&#x2F;s 当由于缓冲区满的时候，网卡设备接收端每秒钟丢掉的网络包的数目<br></font><font style=\"color:rgb(0, 0, 0);\">txdrop&#x2F;s 当由于缓冲区满的时候，网络设备发送端每秒钟丢掉的网络包的数目<br></font><font style=\"color:rgb(0, 0, 0);\">txcarr&#x2F;s 当发送数据包的时候，每秒钟载波错误发生的次数<br></font><font style=\"color:rgb(0, 0, 0);\">rxfram 在接收数据包的时候，每秒钟发生的帧对其错误的次数<br></font><font style=\"color:rgb(0, 0, 0);\">rxfifo 在接收数据包的时候，每秒钟缓冲区溢出的错误发生的次数<br></font><font style=\"color:rgb(0, 0, 0);\">txfifo 在发生数据包 的时候，每秒钟缓冲区溢出的错误发生的次数<br></font><font style=\"color:rgb(0, 0, 0);\">1.10.3：sar -n SOCK 1 1 #统计socket连接信息</font></p>\n<p><font style=\"color:rgb(0, 0, 0);\">sar -n SOCK 1 1 #统计socket连接信息<br></font><font style=\"color:rgb(0, 0, 0);\">totsck 当前被使用的socket总数<br></font><font style=\"color:rgb(0, 0, 0);\">tcpsck 当前正在被使用的TCP的socket总数<br></font><font style=\"color:rgb(0, 0, 0);\">udpsck 当前正在被使用的UDP的socket总数<br></font><font style=\"color:rgb(0, 0, 0);\">rawsck 当前正在被使用于RAW的skcket总数<br></font><font style=\"color:rgb(0, 0, 0);\">if-frag 当前的IP分片的数目<br></font><font style=\"color:rgb(0, 0, 0);\">tcp-tw TCP套接字中处于TIME-WAIT状态的连接数量<br></font><font style=\"color:rgb(0, 0, 0);\">########如果你使用FULL关键字，相当于上述DEV、EDEV和SOCK三者的综合</font></p>\n<p><font style=\"color:rgb(0, 0, 0);\">sar -n TCP 1 3 #TCP连接的统计<br></font><font style=\"color:rgb(0, 0, 0);\">active&#x2F;s 新的主动连接<br></font><font style=\"color:rgb(0, 0, 0);\">passive&#x2F;s 新的被动连接<br></font><font style=\"color:rgb(0, 0, 0);\">iseg&#x2F;s 接受的段<br></font><font style=\"color:rgb(0, 0, 0);\">oseg&#x2F;s 输出的段</font></p>\n<p><font style=\"color:rgb(0, 0, 0);\">sar -n 使用总结</font></p>\n<p><font style=\"color:rgb(0, 0, 0);\">-n DEV ： 网络接口统计信息。<br></font><font style=\"color:rgb(0, 0, 0);\">-n EDEV ： 网络接口错误。<br></font><font style=\"color:rgb(0, 0, 0);\">-n IP ： IP数据报统计信息。<br></font><font style=\"color:rgb(0, 0, 0);\">-n EIP ： IP错误统计信息。<br></font><font style=\"color:rgb(0, 0, 0);\">-n TCP ： TCP统计信息。<br></font><font style=\"color:rgb(0, 0, 0);\">-n ETCP ： TCP错误统计信息。<br></font><font style=\"color:rgb(0, 0, 0);\">-n SOCK ： 套接字使用。</font></p>\n<h4 id=\"进程，文件状态\"><a href=\"#进程，文件状态\" class=\"headerlink\" title=\"进程，文件状态\"></a><font style=\"color:rgb(0, 0, 0);\">进程，文件状态</font></h4><p><font style=\"color:rgb(0, 0, 0);\">sar -v #进程、inode、文件和锁表状态 ，每间隔1秒钟统计一次总共统计三次：#sar -v 1 3</font></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@localhost</span> ~]# sar -v <span class=\"number\">1</span> <span class=\"number\">3</span></span><br><span class=\"line\">Linux <span class=\"number\">3.10</span><span class=\"number\">.0</span>-<span class=\"number\">1160.</span>el7.x86_64 (localhost.localdomain)    <span class=\"number\">2025</span>年<span class=\"number\">04</span>月<span class=\"number\">26</span>日  _x86_64_        (<span class=\"number\">2</span> CPU)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">11</span>时<span class=\"number\">59</span>分<span class=\"number\">59</span>秒 dentunusd   file-nr  inode-nr    pty-nr</span><br><span class=\"line\"><span class=\"number\">12</span>时<span class=\"number\">00</span>分<span class=\"number\">00</span>秒     <span class=\"number\">22736</span>      <span class=\"number\">1280</span>     <span class=\"number\">26803</span>         <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">12</span>时<span class=\"number\">00</span>分<span class=\"number\">01</span>秒     <span class=\"number\">22747</span>      <span class=\"number\">1280</span>     <span class=\"number\">26810</span>         <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">12</span>时<span class=\"number\">00</span>分<span class=\"number\">02</span>秒     <span class=\"number\">22747</span>      <span class=\"number\">1280</span>     <span class=\"number\">26810</span>         <span class=\"number\">2</span></span><br><span class=\"line\">平均时间:     <span class=\"number\">22743</span>      <span class=\"number\">1280</span>     <span class=\"number\">26808</span>         <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n<p><font style=\"color:rgb(0, 0, 0);\">dentunusd 在缓冲目录条目中没有使用的条目数量<br></font><font style=\"color:rgb(0, 0, 0);\">file-nr 被系统使用的文件句柄数量<br></font><font style=\"color:rgb(0, 0, 0);\">inode-nr 已经使用的索引数量<br></font><font style=\"color:rgb(0, 0, 0);\">pty-nr 使用的pty数量</font></p>\n<h4 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">默认监控: sar <span class=\"number\">5</span> <span class=\"number\">5</span>     <span class=\"comment\">//  CPU和IOWAIT统计状态 </span></span><br><span class=\"line\">(<span class=\"number\">1</span>) sar -b <span class=\"number\">5</span> <span class=\"number\">5</span>        <span class=\"comment\">// IO传送速率</span></span><br><span class=\"line\">(<span class=\"number\">2</span>) sar -B <span class=\"number\">5</span> <span class=\"number\">5</span>        <span class=\"comment\">// 页交换速率</span></span><br><span class=\"line\">(<span class=\"number\">3</span>) sar -c <span class=\"number\">5</span> <span class=\"number\">5</span>        <span class=\"comment\">// 进程创建的速率</span></span><br><span class=\"line\">(<span class=\"number\">4</span>) sar -d <span class=\"number\">5</span> <span class=\"number\">5</span>        <span class=\"comment\">// 块设备的活跃信息</span></span><br><span class=\"line\">(<span class=\"number\">5</span>) sar -n DEV <span class=\"number\">5</span> <span class=\"number\">5</span>    <span class=\"comment\">// 网路设备的状态信息</span></span><br><span class=\"line\">(<span class=\"number\">6</span>) sar -n SOCK <span class=\"number\">5</span> <span class=\"number\">5</span>   <span class=\"comment\">// SOCK的使用情况</span></span><br><span class=\"line\">(<span class=\"number\">7</span>) sar -n ALL <span class=\"number\">5</span> <span class=\"number\">5</span>    <span class=\"comment\">// 所有的网络状态信息</span></span><br><span class=\"line\">(<span class=\"number\">8</span>) sar -P ALL <span class=\"number\">5</span> <span class=\"number\">5</span>    <span class=\"comment\">// 每颗CPU的使用状态信息和IOWAIT统计状态 </span></span><br><span class=\"line\">(<span class=\"number\">9</span>) sar -q <span class=\"number\">5</span> <span class=\"number\">5</span>        <span class=\"comment\">// 队列的长度（等待运行的进程数）和负载的状态</span></span><br><span class=\"line\">(<span class=\"number\">10</span>) sar -r <span class=\"number\">5</span> <span class=\"number\">5</span>       <span class=\"comment\">// 内存和swap空间使用情况</span></span><br><span class=\"line\">(<span class=\"number\">11</span>) sar -R <span class=\"number\">5</span> <span class=\"number\">5</span>       <span class=\"comment\">// 内存的统计信息（内存页的分配和释放、系统每秒作为BUFFER使用内存页、每秒被cache到的内存页）</span></span><br><span class=\"line\">(<span class=\"number\">12</span>) sar -u <span class=\"number\">5</span> <span class=\"number\">5</span>       <span class=\"comment\">// CPU的使用情况和IOWAIT信息（同默认监控）</span></span><br><span class=\"line\">(<span class=\"number\">13</span>) sar -v <span class=\"number\">5</span> <span class=\"number\">5</span>       <span class=\"comment\">// inode, file and other kernel tablesd的状态信息</span></span><br><span class=\"line\">(<span class=\"number\">14</span>) sar -w <span class=\"number\">5</span> <span class=\"number\">5</span>       <span class=\"comment\">// 每秒上下文交换的数目</span></span><br><span class=\"line\">(<span class=\"number\">15</span>) sar -W <span class=\"number\">5</span> <span class=\"number\">5</span>       <span class=\"comment\">// SWAP交换的统计信息(监控状态同iostat 的si so)</span></span><br><span class=\"line\">(<span class=\"number\">16</span>) sar -x <span class=\"number\">2906</span> <span class=\"number\">5</span> <span class=\"number\">5</span>  <span class=\"comment\">// 显示指定进程(2906)的统计信息，信息包括：进程造成的错误、用户级和系统级用户CPU的占用情况、运行在哪颗CPU上</span></span><br><span class=\"line\">(<span class=\"number\">17</span>) sar -y <span class=\"number\">5</span> <span class=\"number\">5</span>       <span class=\"comment\">// TTY设备的活动状态</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"USE观测法\"><a href=\"#USE观测法\" class=\"headerlink\" title=\"USE观测法\"></a>USE观测法</h3><p>使用率</p>\n<p>饱和度</p>\n<p>错误</p>\n<p>以Java线程池为例，</p>\n<ol>\n<li>线程池是一个软件资源，</li>\n<li>线程池的使用率：正在运行线程数占线程池总线程数百分比</li>\n<li>线程池饱和度：目前正在线程池任务队列中排队的任务数量</li>\n<li>线程池的错误：触发线程池拒绝策略的次数</li>\n</ol>\n<h2 id=\"场景问题分析\"><a href=\"#场景问题分析\" class=\"headerlink\" title=\"场景问题分析\"></a>场景问题分析</h2><p>CPU占用高：</p>\n<p>适合自下向上去分析:</p>\n<ol>\n<li>用户态还是内核态高 </li>\n<li>什么进程占用cpu多  </li>\n<li>什么线程占用多 然</li>\n<li>什么调用栈占用cpu多</li>\n<li>什么请求占用cpu多</li>\n<li><img data-src=\"https://cdn.nlark.com/yuque/0/2025/png/39206930/1745642060360-37129ef5-fb6f-45c4-a59d-5a90db48c421.png\"></li>\n</ol>\n<p>示例：通过top命令可以识别出是进程(用户态)占用高  还是内核占用高</p>\n<p>示例 就可以使用 top发现是那个进程占用高， 然后使用top -h -p pid 就可以发现是什么线程占用高</p>\n<p>示例 可以使用jstack 查看线程栈  jstack pid &gt;stack.log 然后可以使用awk过滤指定线程栈</p>\n<p>找线程和找线程栈是分两步进行的，但是可能来不及， 可以使用arthas的命令去 它可以将两步合并为一步</p>\n<p>arthas是基于Java的，对于非Java进程，可以使用perf record或者bcc中的命令</p>\n<h3 id=\"系统态（内核态）cpu高：\"><a href=\"#系统态（内核态）cpu高：\" class=\"headerlink\" title=\"系统态（内核态）cpu高：\"></a>系统态（内核态）cpu高：</h3><p>系统态主要是 系统调用，中断、内核线程 这三部分组成</p>\n<h4 id=\"系统调用：\"><a href=\"#系统调用：\" class=\"headerlink\" title=\"系统调用：\"></a>系统调用：</h4><p>系统调用是操作系统提供给用户空间程序的一种接口，允许程序请求操作系统的服务，例如访问磁盘(open,read,write) 网络(socket&#x2F;recvfrom&#x2F;sendto）等 内核收到系统调用请求后会先切换到内核态，然后执行相应处理逻辑</p>\n<p>系统调用：由于系统调用是由用户进程触发，可以通过bcc的syscount命令来检查系统调用情况，以及那些进程的系统调用多，</p>\n<h4 id=\"中断：\"><a href=\"#中断：\" class=\"headerlink\" title=\"中断：\"></a>中断：</h4><p>是指计算机在执行程序过程中，由于某些紧急事件或外部设备的请求，暂时停止当前程序执行，转而去处理更优先的任务，处理完这个紧急任务后，计算机系统会返回到被中断地方，继续执行，比如磁盘中断、网络中断</p>\n<ol>\n<li>硬中断：由硬件之间触发，由于硬中断执行过程中，一般需要禁用中断后再处理，因此硬中断需要能快速执行完以避免其他中断信号丢失</li>\n<li>软中断：为了尽可能块执行完硬中断，减少禁用时间，linux设计实现了软中断，用于处理中断中可以延迟处理的部分</li>\n</ol>\n<p>中断可以使用bcc工具 hardirqs和softirqs来诊断</p>\n<h4 id=\"内核线程：\"><a href=\"#内核线程：\" class=\"headerlink\" title=\"内核线程：\"></a>内核线程：</h4><p>linux内核管理着1批内核线程，用来执行特定的任务，如kswapd处理内存回收，ksoftirqd处理软中断等。</p>\n<p>内核线程： 内核线程可以通过pidstat的%system来确认，内核线程一般是以k开头</p>\n<h3 id=\"空闲cpu使用率高\"><a href=\"#空闲cpu使用率高\" class=\"headerlink\" title=\"空闲cpu使用率高\"></a>空闲cpu使用率高</h3><p>情况1 id%使用率高</p>\n<p>这种是空闲cpu使用 </p>\n<ol>\n<li>系统负载不大，可能是没有业务流量，或者是网络丢包导致流量未进系统，例如tcp连接队列或者socket接受缓存配置过小</li>\n<li>线程都被阻塞，无线程占用cpu资源，这种情况下请求耗时会增加，</li>\n</ol>\n<p>情况2 wa%使用率高</p>\n<ol>\n<li>线程阻塞再磁盘访问上，检查磁盘性能指标 使用iostat或者ioping命令检查磁盘性能是否退化</li>\n<li>使用了nfs之类的网络存储 由于网络较慢 wa高可能也是正常的</li>\n</ol>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2025/png/39206930/1745642348328-357af96e-a70b-48b7-b3a3-bc2e158b577b.png\"></p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2025/png/39206930/1745642233132-ff5ae61a-e6ba-49da-a82f-ddd235b86621.png\"></p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2025/png/39206930/1745642262206-d910e0ee-251c-412e-a239-4300858dc932.png\"></p>\n",
            "tags": [
                "java",
                "linux",
                "事故排查"
            ]
        }
    ]
}